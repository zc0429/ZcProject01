<!DOCTYPE html>
<html    < html lang = "åº”ç”¨" >lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
       <æ ‡é¢˜> RE:è‡ªæˆ‘< /æ ‡é¢˜><title>RE:SELF</title>
    < script src = " https://cdn.tailwindcss.com " > < /è„šæœ¬><script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700;900&display=swap" rel="stylesheet">
       < >é£æ ¼<style>
        /* --- è§†è§‰é£æ ¼  --- */
        :   :æ ¹{root {
               â€”â€”bg-base: # e8e8e3;--bg-base: #e8e8e3;
               â€”â€”text-main: # 111;--text-main: #111;
               â€”â€”shadow-hard: 5 px;--shadow-hard: 5px;
               â€”â€”border-thick: 2.5 px;--border-thick: 2.5px;
        }

           èº«ä½“{body {
            font-familyï¼šå®‹ä½“ï¼›font-family: 'Noto Sans SC', sans-serif;
            background - color: var(â€”â€”bg-base);background-color: var(--bg-base);
               é¢œè‰²:var(â€”â€”text-main);color: var(--text-main);
            /* å™ªç‚¹çº¹ç†è¦†ç›–ï¼Œå¢åŠ è´¨æ„Ÿ */
               ä½ç½®:ç›¸å¯¹;position: relative;
        }
        
        /* å™ªç‚¹å±‚ */
           èº«ä½“::{åbody::after {
            content: "";
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.08'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 50;
        }

        /* åŠ¨æ€èƒŒæ™¯å›¾æ¡ˆ */
        .bg-pattern {
            background-image: radial-gradient(#aaa 1px, transparent 1px);
            background-size: 24px 24px;
        }

        /* ç¡¬æœ—å¡ç‰‡é£æ ¼ */
        .neo-card {
            background: white;
            border: var(--border-thick) solid black;
            box-shadow: var(--shadow-hard) var(--shadow-hard) 0px 0px rgba(0,0,0,1);
            transition: transform 0.2s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.2s ease;
            position: relative;   ä½ç½®:ç›¸å¯¹;
            overflow: hidden;
        }

        /* éšæœºå€¾æ–œæ•ˆæœç±» (ç”±JSåŠ¨æ€æ·»åŠ ) */
        .tilt-1 { transform: rotate(-1deg); }
        .tilt-2 { transform: rotate(1deg); }
        .tilt-3 { transform: rotate(-0.5deg); }

        .neo-card:active {
            transform: translate(2px, 2px) rotate(0deg) !important;
            box-shadow: 2px 2px 0px 0px black;
        }

        /* å®ŒæˆçŠ¶æ€ */
        .card-done {
            opacity: 0.9;
            filter: grayscale(0.2);
            background-color: #f4f4f4;
            transform: scale(0.98) rotate(0deg) !important;
            box-shadow: 1px 1px 0px 0px black !important;
        }

        /* è¿›åº¦æ¡åŠ¨ç”» */
        .progress-fill {
            transition: width 1s cubic-bezier(0.22, 1, 0.36, 1);
        }

        /* ç›–ç« åŠ¨ç”» */
        @keyframes stamp-drop {
            0% { transform: scale(3) rotate(-30deg); opacity: 0; }
            40% { transform: scale(0.9) rotate(5deg); opacity: 1; }
            60% { transform: scale(1.05) rotate(-3deg); }
            100% { transform: scale(1) rotate(-8deg); }
        }
        .stamp-mark {
            animation: stamp-drop 0.4s ease-out forwards;
            mix-blend-mode: multiply;
        }

        /* åº•éƒ¨å¯¼èˆªæµ®åŠ¨ */
        .float-nav {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.85);
            border-top: 2px solid black;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden bg-pattern">

    <!-- é¡¶éƒ¨æ•°æ®çœ‹æ¿ -->
    <header class="px-5 pt-8 pb-4 z-10 flex flex-col gap-4 bg-white border-b-2 border-black">
        <div class="flex justify-between items-start">
            <div>
                <h1 class="text-3xl font-black italic tracking-tighter text-black" style="text-shadow: 2px 2px 0px #ddd;">RE:SELF</h1>
                <p id="daily-quote" class="text-xs font-bold text-gray-500 mt-1 max-w-[200px] leading-tight">è½½å…¥ä¸­...</p>
            </div>
            
            <!-- ç­‰çº§å¾½ç«  -->
            <div class="flex flex-col items-end">
                <div class="bg-black text-white px-3 py-1 font-black text-xl transform -rotate-2 border-2 border-transparent shadow-[3px_3px_0px_0px_#888]">
                    LV.<span id="level-display">1</span>
                </div>
                <div class="text-[10px] font-bold mt-2 text-right">
                    XP: <span id="xp-display">0</span> / <span id="next-level-xp">10</span>
                </div>
            </div>
        </div>

        <!-- å…¨å±€ç»éªŒæ¡ -->
        <div class="w-full h-3 border-2 border-black rounded-full overflow-hidden bg-gray-100">
            <div id="xp-bar" class="h-full bg-yellow-400 border-r-2 border-black progress-fill" style="width: 0%"></div>
        </div>
    </header>

    <!-- ä¸»è§†çª— -->
    <main id="app-content" class="flex-1 overflow-y-auto p-4 pb-32 no-scrollbar">
        
        <!-- é¡µé¢ 1: æŠ•ç¥¨ç°åœº -->
        <div id="page-vote">
            <!-- åˆ—è¡¨ -->
            <div id="habit-list" class="space-y-6 mt-2">
                <!-- å¡ç‰‡æ¸²æŸ“åŒº -->
            </div>
            
            <!-- ç©ºçŠ¶æ€æ’ç”» -->
            <div id="empty-state" class="hidden flex flex-col items-center justify-center mt-20 opacity-40 select-none">
                <div class="grid grid-cols-3 gap-1 mb-4">
                    <div class="w-4 h-4 bg-black"></div><div class="w-4 h-4 bg-black"></div><div class="w-4 h-4 bg-transparent"></div>
                    <div class="w-4 h-4 bg-black"></div><div class="w-4 h-4 bg-transparent"></div><div class="w-4 h-4 bg-black"></div>
                    <div class="w-4 h-4 bg-black"></div><div class="w-4 h-4 bg-transparent"></div><div class="w-4 h-4 bg-transparent"></div>
                </div>
                <p class="font-bold tracking-widest text-lg">SYSTEM OFFLINE</p>
                <p class="text-xs mt-1 border-b border-black">Initialize first protocol</p>
            </div>
        </div>

        <!-- é¡µé¢ 2: è“å›¾ (æç®€è¾“å…¥) -->
        <div id="page-add" class="hidden">
            <div class="neo-card p-6 flex flex-col gap-6 rotate-1 max-w-sm mx-auto mt-4">
                <h2 class="text-xl font-black uppercase border-b-4 border-black inline-block self-start pb-1">Create Protocol</h2>
                
                <div>
                    <label class="text-xs font-bold bg-black text-white px-1">NEW IDENTITY</label>
                    <input type="text" id="input-identity" placeholder="æƒ³æˆä¸ºè°ï¼Ÿ (å¦‚: æå®¢)" 
                           class="w-full mt-2 p-3 border-2 border-black font-bold text-lg focus:outline-none focus:shadow-[4px_4px_0px_0px_#000] transition-all bg-yellow-50">
                </div>

                <div>
                    <label class="text-xs font-bold bg-black text-white px-1">MICRO ACTION</label>
                    <input type="text" id="input-micro" placeholder="æœ€å°è¡ŒåŠ¨ (å¦‚: å†™ä¸€è¡Œä»£ç )" 
                           class="w-full mt-2 p-3 border-2 border-black font-bold text-lg focus:outline-none focus:shadow-[4px_4px_0px_0px_#000] transition-all bg-blue-50">
                </div>

                <div class="text-xs text-gray-500 font-bold border-l-2 border-gray-300 pl-2">
                    * ç³»ç»Ÿå°†è‡ªåŠ¨ä¸ºä½ åˆ†é…ä¸“å±è¯†åˆ«è‰²ã€‚<br>
                    * è¿‡ç¨‹ä¹ æƒ¯å°†æ ¹æ®æœ€å°è¡ŒåŠ¨è‡ªåŠ¨ç”Ÿæˆã€‚
                </div>

                <button onclick="addHabit()" class="bg-black text-white py-4 font-black text-xl hover:translate-x-1 hover:translate-y-1 hover:shadow-none shadow-[4px_4px_0px_0px_#444] border-2 border-black transition-all mt-2">
                    INIT >
                </button>
            </div>
        </div>

        <!-- é¡µé¢ 3: æ¡£æ¡ˆé¦† (æ•°æ®) -->
        <div id="page-stats" class="hidden space-y-5">
            <div class="text-sm font-bold bg-white border border-black inline-block px-2 py-1 shadow-[2px_2px_0px_0px_black]">æˆ‘çš„èº«ä»½çŸ©é˜µ</div>
            <div id="stats-container" class="grid grid-cols-1 gap-4">
                <!-- ç»Ÿè®¡å¡ç‰‡ -->
            </div>
            
            <div class="mt-8 pt-6 border-t-2 border-dashed border-gray-300 text-center">
                 <button onclick="clearData()" class="text-xs font-bold text-red-400 uppercase tracking-widest hover:text-red-600">âš  Factory Reset</button>
            </div>
        </div>

    </main>

    <!-- åº•éƒ¨æ‚¬æµ®å¯¼èˆª -->
    <nav class="fixed bottom-0 left-0 w-full h-20 float-nav flex justify-around items-center px-6 z-40 pb-2">
        <button onclick="switchTab('vote')" id="nav-vote" class="flex flex-col items-center opacity-50 transition-all scale-90">
            <span class="text-2xl mb-1">âš¡</span>
            <span class="text-[10px] font-bold tracking-widest">æ‰§è¡Œ</span>
        </button>
        
        <!-- ä¸­é—´çªå‡ºçš„æ·»åŠ æŒ‰é’® -->
        <button onclick="switchTab('add')" id="nav-add" class="bg-black text-white w-14 h-14 rounded-xl border-2 border-black shadow-[3px_3px_0px_0px_rgba(0,0,0,0.2)] flex items-center justify-center transform -translate-y-4 active:scale-95 transition-all">
            <span class="text-3xl font-light pb-1">+</span>
        </button>
        
        <button onclick="switchTab('stats')" id="nav-stats" class="flex flex-col items-center opacity-50 transition-all scale-90">
            <span class="text-2xl mb-1">ğŸ’¾</span>
            <span class="text-[10px] font-bold tracking-widest">æ¡£æ¡ˆ</span>
        </button>
    </nav>

    <script>
        // --- æ ¸å¿ƒé€»è¾‘ V4.0 ---
        
        let habits = JSON.parse(localStorage.getItem('reself_v4_data')) || [];
        
        // è‡ªåŠ¨é…è‰²æ±  (é«˜é¥±å’Œåº¦ï¼Œæ›´æœ‰æ´»åŠ›)
        const palette = [
            '#FF6B6B', // çŠç‘šçº¢
            '#4ECDC4', // é’æ¾ç»¿
            '#FFE66D', // æŸ æª¬é»„
            '#FF9F43', // æ´»åŠ›æ©™
            '#54A0FF', // ç”µå…‰è“
            '#A29BFE', // æ¢¦å¹»ç´«
            '#00D2D3'  // äº®é’è‰²
        ];

        // éšæœºè¯­å½•åº“
        const quotes = [
            "æ¯ä¸€æ¬¡è¡ŒåŠ¨ï¼Œéƒ½æ˜¯å¯¹æ–°èº«ä»½çš„ä¸€å¼ é€‰ç¥¨ã€‚",
            "ä½ ä¸æ˜¯ä½ çš„è¿‡å»ï¼Œä½ æ˜¯ä½ é‡å¤åšçš„äº‹ã€‚",
            "å¾®å°çš„è¿›æ­¥ï¼Œå¤åˆ©çš„åŠ›é‡ã€‚",
            "çƒ‚å¼€å§‹å¥½è¿‡ä¸å¼€å§‹ã€‚",
            "èº«ä»½æ˜¯åŠ¨è¯ï¼Œä¸æ˜¯åè¯ã€‚",
            "ä¸“æ³¨äºç³»ç»Ÿï¼Œè€Œéç»“æœã€‚",
            "ä»Šå¤©ï¼Œä½ ç¡®è®¤äº†ä½ æ˜¯è°å—ï¼Ÿ"
        ];

        function init() {
            refreshQuote();
            updateLevel();
            switchTab('vote');
        }

        function refreshQuote() {
            const randomQ = quotes[Math.floor(Math.random() * quotes.length)];
            document.getElementById('daily-quote').innerText = `â€œ${randomQ}â€`;
        }

        function saveData() {
            localStorage.setItem('reself_v4_data', JSON.stringify(habits));
            render();
            updateLevel();
        }

        // ç»éªŒå€¼ä¸ç­‰çº§è®¡ç®—ç³»ç»Ÿ
        function updateLevel() {
            // æ¯ä¸€ç¥¨ = 10 XP
            const totalVotes = habits.reduce((acc, curr) => acc + (curr.history ? curr.history.length : 0), 0);
            const xp = totalVotes * 10;
            
            // ç®€å•ç­‰çº§å…¬å¼: Level = 1 + floor(sqrt(XP / 50))
            // 1çº§: 0-49 XP, 2çº§: 50 XP ... è¶Šå¾€åè¶Šéš¾
            const level = 1 + Math.floor(Math.sqrt(xp / 50));
            
            // è®¡ç®—å½“å‰ç­‰çº§è¿›åº¦
            const currentLevelBaseXP = 50 * Math.pow(level - 1, 2);
            const nextLevelBaseXP = 50 * Math.pow(level, 2);
            const neededForNext = nextLevelBaseXP - currentLevelBaseXP;
            const currentProgress = xp - currentLevelBaseXP;
            
            const percentage = Math.min(100, Math.max(0, (currentProgress / neededForNext) * 100));

            // æ›´æ–° UI
            document.getElementById('level-display').innerText = level;
            document.getElementById('xp-display').innerText = Math.floor(currentProgress);
            document.getElementById('next-level-xp').innerText = Math.floor(neededForNext);
            document.getElementById('xp-bar').style.width = `${percentage}%`;
        }

        function addHabit() {
            const identity = document.getElementById('input-identity').value;
            const micro = document.getElementById('input-micro').value;

            if (!identity || !micro) return alert("æŒ‡ä»¤ä¸å®Œæ•´");

            // è‡ªåŠ¨åˆ†é…é¢œè‰² (åŸºäºæ—¶é—´æˆ³å–æ¨¡)
            const colorIndex = Date.now() % palette.length;
            
            habits.push({
                id: Date.now(),
                identity: identity,
                habit: `æˆä¸º${identity}`, // è‡ªåŠ¨å¡«å……
                micro: micro,
                color: palette[colorIndex],
                history: []
            });

            document.getElementById('input-identity').value = '';
            document.getElementById('input-micro').value = '';
            switchTab('vote');
            saveData();
        }

        function toggleVote(id) {
            const habit = habits.find(h => h.id === id);
            const today = new Date().toLocaleDateString('en-CA');

            if (!habit.history) habit.history = [];

            if (habit.history.includes(today)) {
                habit.history = habit.history.filter(date => date !== today);
            } else {
                habit.history.push(today);
                if (navigator.vibrate) navigator.vibrate([10, 30]); 
            }
            saveData();
        }

        function deleteHabit(id) {
            if(confirm('åˆ é™¤æ­¤èº«ä»½åè®®ï¼Ÿ')) {
                habits = habits.filter(h => h.id !== id);
                saveData();
            }
        }

        function calculateStreak(history) {
            if (!history || history.length === 0) return 0;
            const sorted = [...history].sort().reverse();
            let streak = 0;
            let currentCheck = new Date();
            
            const todayStr = currentCheck.toLocaleDateString('en-CA');
            if (!sorted.includes(todayStr)) currentCheck.setDate(currentCheck.getDate() - 1);

            while (true) {
                const dateStr = currentCheck.toLocaleDateString('en-CA');
                if (sorted.includes(dateStr)) {
                    streak++;
                    currentCheck.setDate(currentCheck.getDate() - 1);
                } else {
                    break;
                }
            }
            return streak;
        }

        function render() {
            const list = document.getElementById('habit-list');
            const empty = document.getElementById('empty-state');
            const stats = document.getElementById('stats-container');
            
            list.innerHTML = '';
            stats.innerHTML = '';

            if (habits.length === 0) {
                empty.classList.remove('hidden');
            } else {
                empty.classList.add('hidden');
                
                const todayStr = new Date().toLocaleDateString('en-CA');

                habits.forEach((h, index) => {
                    const history = h.history || [];
                    const isDone = history.includes(todayStr);
                    const streak = calculateStreak(history);
                    const total = history.length;
                    
                    // éšæœºå¾®å€¾æ–œè§’åº¦ (åŸºäºIDå›ºå®šï¼Œä¸ä¼šä¹±è·³)
                    const tiltClass = `tilt-${(h.id % 3) + 1}`;

                    // --- æ¸²æŸ“é¦–é¡µå¡ç‰‡ ---
                    const card = document.createElement('div');
                    card.className = `neo-card p-0 flex min-h-[110px] group select-none ${tiltClass} ${isDone ? 'card-done' : ''}`;
                    // ç‚¹å‡»æ•´ä¸ªå¡ç‰‡æŠ•ç¥¨
                    card.onclick = () => toggleVote(h.id);
                    
                    card.innerHTML = `
                        <!-- å·¦ä¾§è‰²æ¡ -->
                        <div class="w-3 border-r-2 border-black" style="background-color: ${h.color}"></div>
                        
                        <!-- å†…å®¹ -->
                        <div class="flex-1 p-4 flex flex-col justify-between relative">
                            <div>
                                <div class="flex justify-between items-start">
                                    <span class="text-[10px] font-black uppercase tracking-widest text-gray-400">Identity Protocol</span>
                                    ${streak > 1 ? `<span class="text-[10px] font-bold bg-yellow-300 border border-black px-1">ğŸ”¥ ${streak} å¤©è¿èƒœ</span>` : ''}
                                </div>
                                <h3 class="text-xl font-black mt-1 leading-tight">${h.micro}</h3>
                                <p class="text-xs font-bold text-gray-400 mt-1">æˆ‘æ˜¯${h.identity}</p>
                            </div>

                            <!-- åº•éƒ¨ä¿¡æ¯ -->
                            <div class="flex justify-between items-end mt-3">
                                <div class="text-[10px] font-mono text-gray-400">Total XP: ${total * 10}</div>
                                ${!isDone ? `<div class="w-4 h-4 rounded-full border-2 border-black animate-pulse bg-${h.color}"></div>` : ''}
                            </div>

                            <!-- åˆ é™¤æŒ‰é’® (ä»…åœ¨æœªå®Œæˆæ—¶å®¹æ˜“è¯¯è§¦ï¼Œæ”¾åœ¨è§’è½) -->
                            <button onclick="event.stopPropagation(); deleteHabit(${h.id})" class="absolute top-0 right-0 p-2 text-gray-200 hover:text-red-500 font-bold text-lg leading-none">Ã—</button>
                        </div>

                        <!-- ç›–ç« æ•ˆæœ -->
                        ${isDone ? `
                            <div class="absolute right-2 top-1/2 transform -translate-y-1/2 stamp-mark pointer-events-none">
                                <div class="border-4 border-black w-20 h-20 rounded-full flex items-center justify-center opacity-20">
                                    <div class="border-2 border-black w-16 h-16 rounded-full"></div>
                                </div>
                                <div class="absolute inset-0 flex items-center justify-center text-red-600 font-black text-xl tracking-widest rotate-[-15deg]" style="text-shadow: 1px 1px 0px rgba(255,0,0,0.2);">
                                    DONE
                                </div>
                            </div>
                        ` : ''}
                    `;
                    list.appendChild(card);


                    // --- æ¸²æŸ“ç»Ÿè®¡å¡ç‰‡ ---
                    const statItem = document.createElement('div');
                    statItem.className = "neo-card p-4";
                    
                    // ç”Ÿæˆçƒ­åŠ›ç‚¹
                    let heatHTML = '<div class="flex flex-wrap gap-1 justify-end mt-2">';
                    for (let i = 13; i >= 0; i--) {
                        const d = new Date();
                        d.setDate(d.getDate() - i);
                        const dStr = d.toLocaleDateString('en-CA');
                        const hit = history.includes(dStr);
                        heatHTML += `<div class="w-3 h-3 border border-black ${hit ? '' : 'bg-gray-100'}" style="background-color: ${hit ? h.color : ''}"></div>`;
                    }
                    heatHTML += '</div>';

                    statItem.innerHTML = `
                        <div class="flex justify-between items-center border-b-2 border-black pb-2 mb-2">
                            <span class="font-black text-lg border-l-4 border-black pl-2" style="border-color:${h.color}">${h.identity}</span>
                            <span class="font-mono text-xs font-bold bg-black text-white px-1">LV.${Math.floor(total/10) + 1}</span>
                        </div>
                        <div class="flex justify-between text-xs font-bold text-gray-500">
                            <span>æŠ•å…¥: ${total} ç¥¨</span>
                            <span>æœ€è¿‘14å¤©è¡¨ç°:</span>
                        </div>
                        ${heatHTML}
                    `;
                    stats.appendChild(statItem);
                });
            }
        }

        function switchTab(tab) {
            ['vote', 'add', 'stats'].forEach(t => document.getElementById(`page-${t}`).classList.add('hidden'));
            document.getElementById(`page-${tab}`).classList.remove('hidden');
            
            // å¯¼èˆªæ çŠ¶æ€åˆ‡æ¢
            document.getElementById('nav-vote').style.opacity = tab === 'vote' ? '1' : '0.5';
            document.getElementById('nav-vote').style.transform = tab === 'vote' ? 'scale(1.1)' : 'scale(0.9)';
            
            document.getElementById('nav-stats').style.opacity = tab === 'stats' ? '1' : '0.5';
            document.getElementById('nav-stats').style.transform = tab === 'stats' ? 'scale(1.1)' : 'scale(0.9)';

            if(tab === 'vote') refreshQuote(); // å›é¦–é¡µåˆ·æ–°è¯­å½•
            render();
        }

        function clearData() {
            if(confirm('ç³»ç»Ÿé‡ç½®ï¼šæ‰€æœ‰èº«ä»½æ•°æ®å°†ä¸¢å¤±ï¼Œç¡®å®šç»§ç»­å—ï¼Ÿ')) {
                localStorage.removeItem('reself_v4_data');
                location.reload();
            }
        }

        init();

    </script>
</body>

</html>
